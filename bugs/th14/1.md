[title=DDC: Bulletless Kagerou]
# Bulletless Kagerou
[hr_major]

## [specs]
[hr_minor]

* **Versions**: [yes]1.00a[/yes] - [yes]1.00b[/yes]
* **Difficulty**: [yes]Easy[/yes] - [yes]Normal[/yes] - [yes]Hard[/yes] - [yes]Lunatic[/yes] - [yes]Extra[/yes]
* **Mode**: [yes]Main game[/yes] -  [yes]Practice mode[/yes] - [no]Spell practice[/no]
* **Shottype**: [yes]ReimuA[/yes] - [yes]ReimuB[/yes] - [yes]MarisaA[/yes] - [yes]MarisaB[/yes] - [yes]SakuyaA[/yes] - [yes]SakuyaB[/yes]

## [what]
[hr_minor]

Kagerou stops shooting bullets on her second spell, third non-spell and third spell. This effect does not take place in the other stages.
[img=bugs/th14/1_comparison.png, figtitle=Two screenshots of Kagerou's third non-spell. Left side shows what it's like normally. Right side shows no bullets., alt=Two screenshots of SakuyaA fighting against Kagerou] [br]

## [how]
[hr_minor]

[hl2]The player must repeatedly bomb and/or die on Kagerou's mid-boss spell and/or Kagerou's second spell[/hl2]. These actions must be done at specific times, particularly right after Kagerou howls. This must be done until ``2,000`` bullets have prematurely been cleared.

## [why]
[hr_minor]

Kagerou's mid-boss spell and second spell both create invisible bullets that spawn after a few game ticks. The invisible bullets count towards the bullet cap, which is set at ``2,000``. 

The bullets use an ECL instruction called [ins=0, n=611]. This ECL instruction adds a transformation to the bullet, which is set with [ins=0, n=611]'s argument ``type``. In this glitch, this value is equal to ``67108864``, or ``0x04000000`` in hexadecimal.

For simplicitly, I will use a [a=https://priw8.github.io/#s=MERLIN/doc/functions/transformations]MERLIN macro[/a] that makes it easier to understand the explanation. Using the macro, the value ``0x04000000`` corresponds to [ins=2, n=BulletEffectType-67108864]. This bullet transformation hides the bullet for ``time``. During this time, it will not move, will be invisible and won't have a hitbox.

When a bullet of transfomation ``0x04000000`` is set, the bullet sets an internal flag called [ins=2, n=6]. While this flag is set, the bullet will be invisible and not have a hitbox. This flag is cleared once the delay timer ends.

When a bullet is cleared (either through dying or bombing), a state variable is changed from 1 (normal) to 4 (in the process of being cleared). When the bullet's state variable is 4, any instructions set by [ins=0, n=611] are skipped. In the example of transformation ``0x04000000``, it means that any instructions related to the ``time`` variable are skipped.

If the time of a particular bullets happens to be positive (i.e. [ins=2, n=6] is ``true``), it means that the bullet is invisible. However, since instructions using the ``time`` variable are skipped, the flag [ins=2, n=6] can never be changed to ``false``. The implication of this is that the bullet will forever remain in a state in which it takes up a slot in the bullet list while never visually appearing on-screen.
<!-- 
1. Spell uses bullets of transformation 67108864: bullets that use flag 67108864 spawn themselves after ``n`` ticks. Those bullets have an internal flag set to 0x200 set to each bullet. This flag is unset once ``n`` ticks have passed.
2. When the bullet is cancelled (whether it'd be a normal bullet, or the bullet of flag 67108864 before ``n`` ticks have passed), a different flag of the bullet is changed: that flag changes from 1 (normal) to 4 (in the process of being cleared). If flag is 4 then etEx instructions are skipped. In this case, the timer ``n`` is skipped.
3. Timer ``n`` is skipped but flag 0x200 is still set. Code states that the bullet doesn't get deleted if flag 0x200 is set (this flag is checked for explicitly): the bullet takes up slot in the bullet list despite being invisible. -->


[hl2]Through bombing and/or dying, the bullets are cleared off-screen. This also includes the invisible bullets[/hl2]. However, when clearing the invisible bullets, the game still thinks the bullets are still on-screen because they have never spawned. [hl2]When repeatedly bombing and/or dying, Kagerou will have spawned ``2,000`` invisible bullets[/hl2]. The bullet cap has reached its maximum so no more bullets can be spawned.




[hr_major]
## [links]
[hr_minor]
### [rpy]
[hr_minor]

+ [replay=UOqn0F4Txs]

### [vid]
[hr_minor]