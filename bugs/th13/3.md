[title=TD: Yoshika Weird Behaviour]
# Yoshika Weird Behaviour
[hr_major]

## [specs]
[hr_minor]

* **Versions**: [yes]1.00a[/yes] - [yes]1.00b[/yes] - [yes]1.00c[/yes]
* **Difficulty**: [yes]Easy[/yes] - [yes]Normal[/yes] - [yes]Hard[/yes] - [yes]Lunatic[/yes] - [no]Extra[/no] - [no]Overdrive[/no]
* **Mode**: [yes]Main game[/yes] - [yes]Practice mode[/yes] - [no]Spell practice[/no]
* **Shottype**: [no]Reimu[/no] - [yes]Marisa[/yes] - [no]Sanae[/no] - [yes]Youmu[/yes]

## [what]
[hr_minor]

Sometimes when Yoshika is dead, she will not be revived by Seiga: Seiga continues to shoot bullets as if Yoshika is still alive. This behaviour only happens on the first two spell cards of Seiga regardless of difficulty. Additionally, this behaviour is most commonly encountered in practice mode (especially using practice tools), but it is also possible to encounter this issue in a real run.

## [how]
[hr_minor]



## [why]
[hr_minor]

The game uses global variables (e.g. [ins=1, n=-9926], [ins=1, n=-9925], [ins=1, n=-9924], [ins=1, n=-9923]) for certain patterns. When a stage is loaded, every global variable's value is set to 0.

[code]GI0 = 0;
GI1 = 0;
GI2 = 0;
GI3 = 0;
[/code]

This global variable initialisation is done every time a new stage is loaded into the memory, which is when you load a stage through either a stage transition or from the main menu. Note that this initialisation is not done when you reload the stage by e.g. Esc + R. For our interest, this issue is related to how global var [var] is accessed and written to by the game's code.

In the context of this bug, the variable [ins=1, n=-9925] is used. In particular, the variable [ins=1, n=-9925] can have two values in this stage:
1. ``[ins=1, n=-9925] = 0``, which is the state when Yoshika is dead on attacks Spell 1, Spell 2, Non-spell 3, and Spell 3
2. ``[ins=1, n=-9925] = 1``, which is the state when Yoshika is alive on attacks Spell 1, Spell 2, Non-spell 3, and Spell 3

This state is used by Seiga, who will proceed to do a different action depending on the attack the value of [ins=1, n=-9925] was changed on. For example, when ``[ins=1, n=-9925] = 0`` on the third non-spell, Seiga shoots more knives at the player, or when ``[ins=1, n=-9925] = 0`` on the first spell, Seiga will resurrect Yoshika.

INSERT images of both states.0: she does nothing, 1: she revives yoshika/shoots more knives

This bug happens because the global variable gi1 has an incorrect value 

sections that are bugged:

spell 1:

spell 2:



sections that are not bugged:

non 1: this non does not read or write to gi1, so it never bugs out

non 2: this non does not read or write to gi1, so it never bugs out

non 3: this non does read and write to gi1. however the window of time provided along with her high health makes it impossible to achieve this 

spell 3:

similarly, this spell has the same logic as spell 1 and 2. However, the bug cannot be triggered on this spell because non 3 overwrites the death call back and sets it to 0 when she dies, which is the same as the death call back of the third spell also setting it to 0. usually the deathcallback gets set on yoshika when she finishes moving to her spot, which happens 160 frames after the spell starts or 

[hr_major]
## [links]
[hr_minor]
### [rpy]
[hr_minor]
### [vid]
[hr_minor]
