[title=EoSD: Bomb Pause Desync]  
# Bomb Pause Desync
  
[hr_major]  
## [specs]  
[hr_minor]

* **Versions**: [unknown]1.00[/unknown] - [unknown]1.01[/unknown] - [unknown]1.02[/unknown] - [unknown]1.02a[/unknown] - [unknown]1.02b[/unknown] - [unknown]1.02c[/unknown] - [unknown]1.02d[/unknown] - [unknown]1.02e[/unknown] - [unknown]1.02f[/unknown] - [yes]1.02h[/yes]
* **Difficulty**: [yes]Easy[/yes] - [yes]Normal[/yes] - [yes]Hard[/yes] - [yes]Lunatic[/yes] - [yes]Extra[/yes]
* **Mode**: [yes]Main game[/yes] - [yes]Practice mode[/yes]
* **Shottype**: [yes]ReimuA[/yes] - [yes]ReimuB[/yes] - [yes]MarisaA[/yes] - [yes]MarisaB[/yes]


## [what]
[hr_minor]

By pausing in-game, this may result in a desync. The desync is very noticeable, as the player uses a bomb in the replay while not having used a bomb during gameplay. This desync can happen at any point.

## [how]
[hr_minor]

The desync is caused by *holding* the bomb button ``X`` while the game is exiting out of the pause menu and having at least 1 bomb in stock. There have been no reports of such a desync but this is entirely possible.


## [why]
[hr_minor]

This has to do with how the game handles its button events.
In the games EoSD, PCB and IN, the **button events are still registered while paused**. This is not the case in modern games.

This can be visualised with the tool [a=https://www.shrinemaiden.org/forum/index.php?topic=16024.0]thinput[/a], which is a tool that views the player input when playing live or when watching a replay.

+ If a replay from **one of the games EoSD/PCB/IN** is played with the tool thinput active, and the game is paused, then **thinput should show that no buttons are being pressed**.
+ If a replay from **a game other than EoSD/PCB/IN** is played with the tool thinput active, and the game is paused, then **thinput should show that some of the buttons are being pressed**.


### Button events
[hr_minor]

There are three button events:
1. Key is pressed 
2. Key is held
3. Key is released

Here are some actions that are done when a **key is held**:
+ Player shooting
+ Player moving
+ Skipping through dialogue (by using ``Ctrl`` button)

Here are some actions that are done when a **key is pressed**
+ **Skipping through dialogue (by using ``Z`` button)**
+ Player bombing

### Live playthrough
[hr_minor]

Consider the following table of a player pausing mid-game with at least 1 bomb in stock:

| Global timer     | 1 | 2 | 3 | [hl]4[/hl] | [hl]5[/hl] | [hl]6[/hl] | 7 | 8 |
|------------------|---|---|---|---|---|---|---|---|
| In-game timer    | 1 | 2 | 3 | [hl]3[/hl] | [hl]3[/hl] | [hl]3[/hl] | 4 | 5 |
| Is X button held?|  :NO: | :NO:  | :NO:  | [hl]:NO:[/hl]  | [hl]:YES:[/hl]  | [hl]:YES:[/hl]  | :YES:  | :YES:  |

[br] The ``Global timer`` is a value that increases by ``1`` every frame.
The ``In-game timer`` is a value that increases by ``1`` every frame unless the game is paused.
The ``Is X button held?`` is a value that is either True (marked with :YES:) or False (marked with :NO:).

The three highlighted columns indicate that the game is **paused**. The game is paused in the Global Timer interval ``[4, 6]``


When skipping through dialogue by pressing the ``X`` button, The ``X`` key **must be pressed**. This means that one frame before ``X`` is ":YES:", ``X`` must be ":NO:". for it to be a ``X`` *press*.
When the ``Global timer`` is equal to ``7``, the game is no longer paused. The game then checks if ``X`` is pressed. For this, the game checks the following two conditions:
1. ``Is X button held?`` = :YES: on ``Global timer`` = ``7``;
2. ``Is X button held?`` = :NO: on ``Global timer`` = ``6``.

The second condition is not met, **so** ``X`` **is not pressed**. This means that **no bomb is used while playing the game yourself**.

### Replay mode
[hr_minor]

Consider the same table from before:

| Global timer     | 1 | 2 | 3 | [c=invis]4[/c] | [c=invis]5[/c] | [c=invis]6[/c] | 7 | 8 |
|------------------|---|---|---|---|---|---|---|---|
| In-game timer    | 1 | 2 | 3 | [c=invis]3[/c] | [c=invis]3[/c] | [c=invis]3[/c] | 4 | 5 |
| Is Z button held?|  :NO: | :NO:  | :NO:  | [c=invis]:NO:[/c]  | [c=invis]:YES:[/c]  | [c=invis]:YES:[/c]  | :YES:  | :YES:  |

[br] The four previously highlighted columns **are left out** intentionally. When watching a replay, the game does not take into account the button presses while pausing. Because of this, we don't look at the ``Global timer`` value, but we instead look at the value of ``In-game timer``.


When the ``In-game timer`` is equal to ``4``, the game is no longer paused. The game then checks if ``X`` is *pressed*. For this, the game checks the following two conditions:
1. ``Is X button held?`` = :YES: on ``In-game timer`` = ``4``;
2. ``Is X button held?`` = :NO: on ``In-game timer`` = ``3``.

All two conditions are met, **so** ``X`` **is pressed**. This means that **a bomb is used while in replay mode**.


### Conclusion
[hr_minor]

In conclusion:
+ ``X`` **is not pressed** while playing the game.
+ ``X`` **is pressed** while watching the replay.

The inputs are the same in both cases, but its effect is different due to the fact ``X`` must be pressed. This causes the noticeable desync glitch.


[hr_major]
## [links]
[hr_minor]
### [rpy]
[hr_minor]
### [vid]
[hr_minor]
### [misc]
[hr_minor]

[a=https://youtu.be/kpk2tdsPh0A?t=75]SM64 - Watch for Rolling Rocks - 0.5x A Presses (Commentated)[/a]