[title=EoSD: MarisaB Backward Laser]
# MarisaB Backward Laser
[hr_major]

## [specs]  
[hr_minor]

* **Versions**: [unknown]1.00[/unknown] - [unknown]1.01[/unknown] - [unknown]1.02[/unknown] - [unknown]1.02a[/unknown] - [unknown]1.02b[/unknown] - [unknown]1.02c[/unknown] - [unknown]1.02d[/unknown] - [unknown]1.02e[/unknown] - [unknown]1.02f[/unknown] - [yes]1.02h[/yes]
* **Difficulty**: [no]Easy[/no] - [no]Normal[/no] - [yes]Hard[/yes] - [yes]Lunatic[/yes] - [yes]Extra[/yes]
* **Mode**: [yes]Main game[/yes] - [yes]Practice mode[/yes]
* **Shottype**: [no]ReimuA[/no] - [no]ReimuB[/no] - [no]MarisaA[/no] - [yes]MarisaB[/yes]

## [what]
[hr_minor]

MarisaB's laser can fire backward, dealing a small amount of damage to enemies that are behind her lasers. This damage only lasts for one tick.

## [how]
[hr_minor]

This can be done by shooting with an enemy being behind MarisaB's lasers. However, the laser does not extend infinitely backwards, so you might not hit an enemy if you are too far away from one. To be more specific, an enemy must be within a 240 unit range of MarisaB's laser to be able to be hit by the laser.

## [why]
[hr_minor]

To understand how this bug happens, we need to look at how player bullets work, We look at player bullets since [hl2]MarisaB's lasers are implemented as a subtype of player bullets[/hl2]. Bullet take many parameters, but the parameters we are interested in are as follows:

+ ``x_pos``: X-position of bullet
+ ``y_pos``: Y-position of bullet
+ ``width``: Width of bullet hitbox
+ ``height``: Height of bullet hitbox

The coordinate system in EoSD works as follows:

[img=bugs/th06/5_grid.png, figtitle=Screenshot showing the x- and y-coordinates of the game, alt=A screenshot showing the coordinates of the game]

Next up we will talk about the initialization and updating process of bullets. 

### Bullet values and execution
[hr_minor]

The table below summarizes the parameter values of MarisaB's lasers:

|                   | x_pos           | y_pos                 | width                            | height          |
| ----------------- | --------------- | --------------------- | -------------------------------- | --------------- |
| On Initialization | `shooter_x_pos` | `shooter_y_pos`       | ``10.0`` or ``15.0`` or ``20.0`` | ``480``         |
| On Update         | `shooter_x_pos` | `shooter_y_pos / 2.0` | ``10.0`` or ``15.0`` or ``20.0`` | `shooter_y_pos` |

[br]

[hl2]The initialized bullet state takes place for one tick before the first update tick occurs[/hl2]. This means the values of "On Initialization" are only true for one tick.

The position of the lasers are of course relative to MarisaB's position. The ``shooter_x_pos`` and ``shooter_y_pos`` values are the x and y coordinate values of MarisaB's shooters, which are the white orbs that are next to her character where her laser spawns from. The width being ``10.0`` or ``15.0`` or ``20.0`` is because the values change depending on MarisaB's power level.

#### On Update
[hr_minor]

Below is an ordinary screenshot of MarisaB, showcasing the "on update" part of her laser:

[img=bugs/th06/8_on_update.png, figtitle=MarisaB's left laser is highlighted. The green area represents the dimensions of the laser (width=20, height=155), and the small pink area is the position of the laser (x_pos=34, y_pos=74), alt=An in-game screenshot of MarisaB firing her lasers with coloured boxes drawn around/in it.]

Although the laser visually extends upward from the shooter, [hl2]the laser's logical position (``x_pos``, ``y_pos``) still represents the center of the laser's hitbox[/hl2]. It means its position has to be in the middle, which is where the pink square is. The laser's height is calculated to be ``shooter_y_pos`` to make sure it reaches the top of the screen. This gets updated every in-game tick until the laser despawns.

#### On Initialization
[hr_minor]

Recall that the laser's height is ``480`` units, which is larger than the visible screen height of ``432``. This means that I cannot show the full laser in a screenshot. To illustrate the backwards laser, I had to cut off the extended laser at the top. The following image is taken where MarisaB is high up on-screen:

[img=bugs/th06/8_on_initialization.png, figtitle=MarisaB's left laser is highlighted. The green area represents the dimensions of the laser (width=20, height=480), and the small pink area is the position of the laser (x_pos=159, y_pos=91). The left laser has been hacked into this position for demonstration purposes., alt=An in-game screenshot of MarisaB firing her lasers with coloured boxes drawn around/in it.]

Since the ``y_pos`` is the same as ``shooter_y_pos``, it means [hl2]the laser is shifted to the middle of her shooter[/hl2]. The ``height`` is initialized to ``480``, so ``240`` units of the laser extend downward. The game never explicitly performs the correction like it does on the "On Update" function, resulting in the laser also partially appearing backwards.

### Conclusion
[hr_minor]

[box=1000]The backwards laser appears for one tick because the laser's center is at her shooter's position, and the laser's height is initialized to 480 units. This means half of the laser's hitbox is extended downward for one tick. On the next update tick, the laser is correctly repositioned higher and resized.[/box]

[hr_major]
## [links]
[hr_minor]
### [rpy]
[hr_minor]

### [vid]
[hr_minor]

[buildCategoriesTable]