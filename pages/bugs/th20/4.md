[title=FW: Reimu Red-2 Shot Desync]
# Reimu Red-2 Shot Desync
[hr_major]

## [specs]  
[hr_minor]

* **Versions**: [yes]1.00a[/yes]
* **Difficulty**: [yes]Easy[/yes] - [yes]Normal[/yes] - [yes]Hard[/yes] - [yes]Lunatic[/yes] - [no]Extra[/no]
* **Mode**: [yes]Main game[/yes] - [no]Practice mode[/no] - [no]Spell practice[/no]  
* **Shottype**: [yes]Reimu[/yes] - [no]Marisa[/no]

## [what]
[hr_minor]

Using the Red-2 stone for the unfocus stone as Reimu might desync your game. This only affects stages after Stage 1: [hl2]Stages 2 through 6[/hl2]. In other words, only main game credits are counted: stage practice, spell practice, and Extra are not affected.


[img=bugs/th20/4_reimu_r2_shot.png, figtitle=Two screenshots of Reimu with her unfocus shot. This shot cycles on a period of 120 frames. The left image shows a narrow gap between Reimu's amulets while the right image shows a wide gap between Reimu's amulets., alt=An in-game screenshot of two Reimu Red-2's with her amulets being at different positions.]

## [how]
[hr_minor]

There are two different ways to desync with Reimu Red-2:

1. If the player starts a Red-2 replay on a stage [hl2]between Stage 2 and Stage 6[/hl2], the replay will desync. Playing the replay starting from Stage 1 might play the replay correctly. 
2. However, if while playing the game, [hl2]the player skipped through the result screen[/hl2] with the Red-2 stone out at the end of a stage, the replay desyncs even when starting from Stage 1.

## [why]
[hr_minor]

Reimu Red-2's shot oscilates on a period of ``T = 120f`` with ``T`` incrementing by ``1`` every game frame. (for technical readers, its value can be read at ``*(int*)(*(int*) th20.exe + 1BA568 + 4) + 0x22B4 + 0x12580 + 4``. This ``T`` value is not saved in the replay. This has the following consequences:

<!-- There are two different ways to desync with Yellow-2: -->
1. Because ``T`` is not saved in the replay, when the game initialises the selected stage, [hl2]``T`` is initiallized to ``0``[/hl2]. This is almost always going to be wrong if you select Stages 2 through 6 in your replay menu.
2. When the replay enters the result screen, [hl2]the replay fully waits out the 5 seconds before the stage transition despite that delay having been skipped in the run[/hl2]. The ``T`` value continues to increment throughout those 5 seconds, causing it to be off-sync from what it is supposed to be. 

Because in both cases the ``T`` value is very likely to not correspond with your original ``T`` value, replays using the wide Red-2 as Reimu have a high chance of desyncing. 

[hr_major]
## [links]
[hr_minor]
### [rpy]
[hr_minor]

+ [replay=I1Vp4uQyhH]

<!-- 
### [vid]
[hr_minor]

None so far. -->

[buildCategoriesTable]